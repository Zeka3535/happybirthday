<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–≤–µ—Å—Ç –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è ‚ù§Ô∏è</title>
    <style>
        :root {
            --primary: #ff3e80;
            --primary-dark: #d61a5e;
            --accent: #5cc7c2;
            --text: #2d3748;
            --glass: rgba(255, 255, 255, 0.90);
            --glass-border: rgba(255, 255, 255, 0.6);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text);
            overflow-x: hidden;
            user-select: none;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .card {
            position: relative;
            z-index: 10;
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 28px;
            padding: 25px 20px;
            width: 92%;
            max-width: 400px;
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.2);
            text-align: center;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        h1 { margin: 0 0 10px; font-size: 24px; font-weight: 800; color: #1a202c; }
        h2 { margin: 0 0 15px; font-size: 14px; color: var(--primary); text-transform: uppercase; letter-spacing: 1.5px; font-weight: 700; }
        p { font-size: 16px; line-height: 1.5; margin-bottom: 20px; color: #4a5568; }

        .emoji-icon {
            font-size: 50px;
            margin-bottom: 10px;
            display: inline-block;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1));
            animation: float 3s ease-in-out infinite;
        }

        input {
            width: 100%; padding: 15px; border: 2px solid #e2e8f0; background: #fff;
            border-radius: 16px; font-size: 18px; text-align: center; margin-bottom: 15px; outline: none;
        }
        input:focus { border-color: var(--primary); }

        button {
            width: 100%; padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white; border: none; border-radius: 16px; font-size: 18px; font-weight: 700;
            cursor: pointer; transition: transform 0.1s; box-shadow: 0 8px 20px -5px rgba(214, 26, 94, 0.4);
        }
        button:active { transform: scale(0.97); }

        /* --- Memory Game --- */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
            perspective: 1000px;
        }

        .mem-card {
            background: transparent;
            aspect-ratio: 1/1;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s;
            -webkit-tap-highlight-color: transparent;
        }

        .mem-card.flip { transform: rotateY(180deg); }
        .mem-card.matched { animation: pulse 0.5s ease-in-out; }

        .mem-front, .mem-back {
            width: 100%; height: 100%;
            position: absolute;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .mem-front {
            background: white;
            transform: rotateY(180deg);
            font-size: 28px;
            border: 2px solid var(--primary);
        }
        
        .mem-back {
            background: linear-gradient(135deg, #667eea, #764ba2);
            font-size: 24px;
            color: rgba(255,255,255,0.8);
        }

        /* --- TTT Game --- */
        .ttt-board {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
            margin: 0 auto 20px; max-width: 260px; background: rgba(255,255,255,0.5);
            padding: 10px; border-radius: 20px;
        }
        .ttt-cell {
            background: white; aspect-ratio: 1; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 36px; font-weight: 900; cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .ttt-cell.x { color: var(--primary); }
        .ttt-cell.o { color: var(--accent); }

        /* --- Overlay & Utils --- */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98); z-index: 50; border-radius: 28px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; opacity: 0; pointer-events: none; transform: scale(0.9); transition: all 0.4s;
        }
        .overlay.active { opacity: 1; pointer-events: all; transform: scale(1); }
        
        .clue-box { 
            color: var(--primary); font-size: 18px; font-weight: 800;
            border: 2px dashed var(--primary); padding: 15px; border-radius: 12px; margin: 20px 0;
            background: rgba(255, 62, 128, 0.05);
        }

        .error-msg { color: #e53e3e; font-weight: bold; font-size: 14px; height: 0; overflow: hidden; transition: 0.3s; margin-bottom: 5px;}
        .error-msg.visible { height: 25px; }

        .progress-wrap { width: 100%; height: 6px; background: #edf2f7; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.5s; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0% { transform: scale(1) rotateY(180deg); } 50% { transform: scale(1.1) rotateY(180deg); } 100% { transform: scale(1) rotateY(180deg); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
        .shake { animation: shake 0.4s; }
        
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>
    <div class="card" id="game-card"></div>

    <script>
        // ==========================================
        // ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –£–†–û–í–ù–ï–ô (–†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨ –¢–£–¢)
        // ==========================================
        const levels = [
            {
                type: "question",
                icon: "üß©", 
                title: "–£—Ä–æ–≤–µ–Ω—å 1: –°–æ–±–∏—Ä–∏ –º–µ–Ω—è!",
                text: "–ù–∞—á–Ω–µ–º —Å –ø—Ä–æ—Å—Ç–æ–≥–æ. –ö–∞–∫ –∑–æ–≤—É—Ç –ª—É—á—à–µ–≥–æ –¥—Ä—É–≥–∞ –ì—É–±–∫–∏ –ë–æ–±–∞?", 
                answers: ["–ø–∞—Ç—Ä–∏–∫"], 
                clue: "–ò—â–∏ —É –ë–æ—Ç–∞–Ω–∏–∫–∞! üëì"
            },
            {
                type: "question",
                icon: "üåå", 
                title: "–£—Ä–æ–≤–µ–Ω—å 2: –ó–≤–µ–∑–¥–Ω—ã–π –ø—É—Ç—å",
                text: "–ü–æ–¥–∞—Ä–æ–∫ –∏–∑ –∫–æ—Å–º–æ—Å–∞. –° –∫–∞–∫–æ–π –ø–∏—Ü—Ü–µ—Ä–∏–∏ –º—ã —á–∞—â–µ –≤—Å–µ–≥–æ –∑–∞–∫–∞–∑—ã–≤–∞–µ–º –ø–∏—Ü—Ü—É?",
                answers: ["–¥–æ–º–∏–Ω–æ—Å", "dominos"], 
                clue: "–í –°–æ–∫–æ–ª–µ –Ω–∞—ë–¥—ë—à! ü¶Ö"
            },
            {
                type: "memory",
                icon: "üí°", 
                title: "–£—Ä–æ–≤–µ–Ω—å 3: –ó–∞–∂–≥–∏ –æ–≥–Ω–∏",
                text: "–ù–∞–π–¥–∏ 6 –ø–∞—Ä!",
                clue: "–¢–∏–≥—Ä –æ—Ö—Ä–∞–Ω—è–µ—Ç! ü¶Å"
            },
            {
                type: "ttt",
                icon: "üéÆ", 
                title: "–§–∏–Ω–∞–ª: –ë–∏—Ç–≤–∞",
                text: "–§–∏–Ω–∞–ª—å–Ω—ã–π –±–æ—Å—Å! –û–±—ã–≥—Ä–∞–π –º–µ–Ω—è –≤ –ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏ (—Ç—ã –∑–∞ ‚ùå).",
                clue: "–ì–õ–ê–í–ù–´–ô –ü–†–ò–ó –ò–©–ò –í –î–ò–í–ê–ù–ê–•, –ö–û–¢–û–†–´–ï –ö–ê–ö –ò–ù–¨-–Ø–ù–¨ –°–¢–û–Ø–¢! ‚òØÔ∏è"
            }
        ];

        // ==========================================
        
        let currentLevel = 0;
        const card = document.getElementById('game-card');
        
        // Memory vars
        let hasFlippedCard = false;
        let lockBoard = false;
        let firstCard, secondCard;
        let matchesFound = 0;

        // TTT vars
        let tttBoard = [];
        let tttActive = false;

        function init() {
            card.innerHTML = `
                <div class="emoji-icon">üéÅ</div>
                <h1>–° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è!</h1>
                <p>–Ø —Å–ø—Ä—è—Ç–∞–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–∞—Ä–∫–æ–≤. –ü—Ä–æ–π–¥–∏ –∏—Å–ø—ã—Ç–∞–Ω–∏—è, —á—Ç–æ–±—ã –∏—Ö –Ω–∞–π—Ç–∏!</p>
                <button onclick="startLevel()">–ù–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç</button>
            `;
        }

        function startLevel() {
            render();
        }

        function render() {
            if (currentLevel >= levels.length) { showEnd(); return; }
            
            const lvl = levels[currentLevel];
            const progress = (currentLevel / levels.length) * 100;
            
            let content = '';
            
            if (lvl.type === 'question') {
                content = `
                    <p>${lvl.text}</p>
                    <input type="text" id="ans" placeholder="–û—Ç–≤–µ—Ç..." autocomplete="off">
                    <div class="error-msg" id="err">–ù–µ–≤–µ—Ä–Ω–æ!</div>
                    <button onclick="checkTextAnswer()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                `;
            } else if (lvl.type === 'memory') {
                content = `
                    <p>${lvl.text}</p>
                    <div class="memory-grid" id="mem-grid"></div>
                `;
            } else if (lvl.type === 'ttt') {
                tttBoard = Array(9).fill('');
                tttActive = true;
                content = `
                    <p>${lvl.text}</p>
                    <div class="ttt-board">
                         ${tttBoard.map((_, i) => `<div class="ttt-cell" onclick="tttMove(${i})" id="c-${i}"></div>`).join('')}
                    </div>
                    <div id="ttt-status" style="font-weight:bold; color:#ff3e80;">–¢–≤–æ–π —Ö–æ–¥!</div>
                `;
            }

            // 1. –°–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
            card.style.opacity = 0;
            card.style.transform = 'translateY(10px)';
            
            // 2. –ñ–¥–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏, –∑–∞—Ç–µ–º –º–µ–Ω—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            setTimeout(() => {
                card.innerHTML = `
                    <div class="progress-wrap"><div class="progress-fill" style="width:${progress}%"></div></div>
                    <div class="emoji-icon">${lvl.icon}</div>
                    <h2>${lvl.title}</h2>
                    ${content}
                    
                    <div class="overlay" id="win-overlay">
                        <div class="emoji-icon">üéâ</div>
                        <h2>–û—Ç–ª–∏—á–Ω–æ!</h2>
                        <p>–ü–æ–¥–∞—Ä–æ–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è:</p>
                        <div class="clue-box">${lvl.clue}</div>
                        <button onclick="nextLevel()">–ù–∞—à–ª–∞!</button>
                    </div>
                `;

                // 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
                card.style.opacity = 1;
                card.style.transform = 'translateY(0)';

                // 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—ã –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ HTML –¥–æ–±–∞–≤–ª–µ–Ω
                if (lvl.type === 'memory') {
                    initMemoryGame();
                }
            }, 300);
        }

        // --- Text Logic ---
        function checkTextAnswer() {
            const inp = document.getElementById('ans');
            const val = inp.value.trim().toLowerCase();
            const correct = levels[currentLevel].answers.map(a => a.toLowerCase());
            
            if (correct.includes(val)) {
                inp.blur();
                levelComplete();
            } else {
                showError();
            }
        }

        // --- Memory Logic ---
        function initMemoryGame() {
            const grid = document.getElementById('mem-grid');
            if (!grid) return; // –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫

            const icons = ['üè†', 'üè†', 'üíç', 'üíç', 'üê±', 'üê±', '‚úàÔ∏è', '‚úàÔ∏è', 'üí°', 'üí°', '‚ù§Ô∏è', '‚ù§Ô∏è'];
            matchesFound = 0;
            
            icons.sort(() => 0.5 - Math.random());

            icons.forEach(icon => {
                const el = document.createElement('div');
                el.classList.add('mem-card');
                el.dataset.icon = icon;
                el.innerHTML = `
                    <div class="mem-front">${icon}</div>
                    <div class="mem-back">?</div>
                `;
                el.addEventListener('click', flipCard);
                grid.appendChild(el);
            });
        }

        function flipCard() {
            if (lockBoard) return;
            if (this === firstCard) return;

            this.classList.add('flip');

            if (!hasFlippedCard) {
                hasFlippedCard = true;
                firstCard = this;
                return;
            }

            secondCard = this;
            checkForMatch();
        }

        function checkForMatch() {
            let isMatch = firstCard.dataset.icon === secondCard.dataset.icon;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            firstCard.classList.add('matched');
            secondCard.classList.add('matched');
            resetBoard();
            matchesFound++;
            if (matchesFound === 6) {
                setTimeout(levelComplete, 600);
            }
        }

        function unflipCards() {
            lockBoard = true;
            setTimeout(() => {
                firstCard.classList.remove('flip');
                secondCard.classList.remove('flip');
                resetBoard();
            }, 1000);
        }

        function resetBoard() {
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }

        // --- TTT Logic ---
        function tttMove(i) {
            if (!tttActive || tttBoard[i] !== '') return;
            
            tttBoard[i] = 'X';
            updateCell(i, 'X');
            
            if (checkWin('X')) { endGame(true); return; }
            if (!tttBoard.includes('')) { 
                document.getElementById('ttt-status').innerText = "–ù–∏—á—å—è! –ï—â–µ —Ä–∞–∑...";
                setTimeout(render, 1500); 
                return; 
            }

            tttActive = false;
            document.getElementById('ttt-status').innerText = "–î—É–º–∞—é...";
            setTimeout(aiMove, 600);
        }

        function aiMove() {
            let move = findMove('O') ?? findMove('X') ?? (tttBoard[4] === '' ? 4 : null);
            
            if (move === null) {
                let avail = tttBoard.map((v, i) => v === '' ? i : null).filter(v => v !== null);
                move = avail[Math.floor(Math.random() * avail.length)];
            }

            tttBoard[move] = 'O';
            updateCell(move, 'O');

            if (checkWin('O')) {
                document.getElementById('ttt-status').innerText = "–Ø –≤—ã–∏–≥—Ä–∞–ª üòú";
                setTimeout(render, 2000);
            } else {
                tttActive = true;
                document.getElementById('ttt-status').innerText = "–¢–≤–æ–π —Ö–æ–¥!";
            }
        }

        function findMove(player) {
            const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            for (let [a,b,c] of lines) {
                if (tttBoard[a]===player && tttBoard[b]===player && tttBoard[c]==='') return c;
                if (tttBoard[a]===player && tttBoard[c]===player && tttBoard[b]==='') return b;
                if (tttBoard[b]===player && tttBoard[c]===player && tttBoard[a]==='') return a;
            }
            return null;
        }

        function updateCell(i, p) {
            const c = document.getElementById(`c-${i}`);
            if(c) {
                c.innerText = p === 'X' ? '‚ùå' : '‚≠ï';
                c.classList.add(p.toLowerCase());
            }
        }

        function checkWin(p) {
            const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            return lines.some(l => tttBoard[l[0]]===p && tttBoard[l[1]]===p && tttBoard[l[2]]===p);
        }

        function endGame(win) {
            if(win) levelComplete();
        }

        // --- Utils ---
        function showError() {
            const err = document.getElementById('err');
            err.classList.add('visible');
            card.classList.add('shake');
            setTimeout(() => card.classList.remove('shake'), 500);
        }

        function levelComplete() {
            fireConfetti();
            document.getElementById('win-overlay').classList.add('active');
        }

        function nextLevel() {
            currentLevel++;
            render();
        }

        function showEnd() {
            fireConfetti();
            setTimeout(fireConfetti, 500);
            card.innerHTML = `
                <div class="emoji-icon">‚ù§Ô∏è</div>
                <h1>–¢—ã –Ω–∞—à–ª–∞ –≤—Å—ë!</h1>
                <p>–¢—ã —É–º–Ω–∏—Ü–∞! –õ—é–±–ª—é —Ç–µ–±—è! üòò</p>
            `;
        }

        // Confetti
        const cvs = document.getElementById('confetti-canvas');
        const ctx = cvs.getContext('2d');
        let confetti = [];
        function resize() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
        window.onresize = resize; resize();

        function fireConfetti() {
            const cols = ['#ff3e80', '#5cc7c2', '#fbd38d'];
            for(let i=0; i<100; i++) confetti.push({
                x: window.innerWidth/2, y: window.innerHeight/2,
                w: Math.random()*10+5, h: Math.random()*5+5, col: cols[Math.floor(Math.random()*3)],
                vx: (Math.random()-0.5)*20, vy: (Math.random()-0.5)*20, g: 0.2, d: 0.96
            });
        }
        function loop() {
            ctx.clearRect(0,0,cvs.width,cvs.height);
            confetti.forEach((c,i) => {
                c.x+=c.vx; c.y+=c.vy; c.vy+=c.g; c.vx*=c.d; c.vy*=c.d;
                ctx.fillStyle=c.col; ctx.fillRect(c.x,c.y,c.w,c.h);
                if(c.y>cvs.height) confetti.splice(i,1);
            });
            requestAnimationFrame(loop);
        }
        loop();

        init();
    </script>
</body>
</html>
